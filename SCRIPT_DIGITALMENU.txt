CREATE TABLE USUARIO (
    IDUSUARIO INT AUTO_INCREMENT PRIMARY KEY,
    USUARIO VARCHAR(30) NOT NULL,
    SENHA VARCHAR(30) NOT NULL,
    TIPOACESSO enum('administrador','atendente') NOT NULL,
    STATUS enum('ATIVADO','DESATIVADO') NOT NULL DEFAULT 'ATIVADO'
);

CREATE TABLE MESA (
    IDMESA INT PRIMARY KEY,
    STATUS enum('ATIVADO','DESATIVADO') NOT NULL DEFAULT 'ATIVADO'
);

CREATE TABLE PEDIDO (
    IDPEDIDO INT AUTO_INCREMENT PRIMARY KEY,
    ID_MESA INT NOT NULL,
    TOTAL DECIMAL(7,2) NOT NULL DEFAULT 0.0, 
    DATA DATETIME NOT NULL DEFAULT NOW(),
    STATUS ENUM('ABERTO','ENCERRADO') NOT NULL DEFAULT 'ABERTO'
);

CREATE TABLE PRODUTO (
    IDPRODUTO INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(30) UNIQUE NOT NULL,
    PRECO DECIMAL(7,2) NOT NULL,
    DESCRICAO VARCHAR(200),
    ID_CATEGORIA INT NOT NULL,
    STATUS enum('ATIVADO','DESATIVADO') NOT NULL DEFAULT 'ATIVADO'
);

CREATE TABLE CARRINHO (
    ID_PEDIDO INT NOT NULL,
    ID_PRODUTO INT NOT NULL,
    QTDE INT NOT NULL,
    SUBTOTAL DECIMAL(7,2) NOT NULL DEFAULT 0.0,
    OBSERVACAO VARCHAR(30),
    STATUS ENUM('AGUARDO','CONFIRMADO') NOT NULL DEFAULT 'AGUARDO',
    HORAPEDIDO TIME NOT NULL DEFAULT (CURTIME())
);

CREATE TABLE CATEGORIA (
    IDCATEGORIA INT AUTO_INCREMENT PRIMARY KEY,
    NOME varchar(30) UNIQUE NOT NULL
);
 
ALTER TABLE PEDIDO ADD CONSTRAINT FK_PEDIDO_MESA
    FOREIGN KEY (ID_MESA)
    REFERENCES MESA (IDMESA)
    ON DELETE CASCADE ON UPDATE CASCADE;
 
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO_CATEGORIA
    FOREIGN KEY (ID_CATEGORIA)
    REFERENCES CATEGORIA (IDCATEGORIA)
    ON DELETE CASCADE ON UPDATE CASCADE;
 
ALTER TABLE CARRINHO ADD CONSTRAINT FK_PEDIDO
    FOREIGN KEY (ID_PEDIDO)
    REFERENCES PEDIDO (IDPEDIDO);
 
ALTER TABLE CARRINHO ADD CONSTRAINT FK_PRODUTO
    FOREIGN KEY (ID_PRODUTO)
    REFERENCES PRODUTO (IDPRODUTO);